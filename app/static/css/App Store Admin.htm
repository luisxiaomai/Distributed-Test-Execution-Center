<!DOCTYPE html>
<!-- saved from url=(0022)http://127.0.0.1:5000/ -->
<html lang="en" class="fontawesome-i2svg-active fontawesome-i2svg-complete"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>App Store Admin</title>
    <style type="text/css">svg:not(:root).svg-inline--fa{overflow:visible}.svg-inline--fa{display:inline-block;font-size:inherit;height:1em;overflow:visible;vertical-align:-.125em}.svg-inline--fa.fa-lg{vertical-align:-.225em}.svg-inline--fa.fa-w-1{width:.0625em}.svg-inline--fa.fa-w-2{width:.125em}.svg-inline--fa.fa-w-3{width:.1875em}.svg-inline--fa.fa-w-4{width:.25em}.svg-inline--fa.fa-w-5{width:.3125em}.svg-inline--fa.fa-w-6{width:.375em}.svg-inline--fa.fa-w-7{width:.4375em}.svg-inline--fa.fa-w-8{width:.5em}.svg-inline--fa.fa-w-9{width:.5625em}.svg-inline--fa.fa-w-10{width:.625em}.svg-inline--fa.fa-w-11{width:.6875em}.svg-inline--fa.fa-w-12{width:.75em}.svg-inline--fa.fa-w-13{width:.8125em}.svg-inline--fa.fa-w-14{width:.875em}.svg-inline--fa.fa-w-15{width:.9375em}.svg-inline--fa.fa-w-16{width:1em}.svg-inline--fa.fa-w-17{width:1.0625em}.svg-inline--fa.fa-w-18{width:1.125em}.svg-inline--fa.fa-w-19{width:1.1875em}.svg-inline--fa.fa-w-20{width:1.25em}.svg-inline--fa.fa-pull-left{margin-right:.3em;width:auto}.svg-inline--fa.fa-pull-right{margin-left:.3em;width:auto}.svg-inline--fa.fa-border{height:1.5em}.svg-inline--fa.fa-li{width:2em}.svg-inline--fa.fa-fw{width:1.25em}.fa-layers svg.svg-inline--fa{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}.fa-layers{display:inline-block;height:1em;position:relative;text-align:center;vertical-align:-12.5%;width:1em}.fa-layers svg.svg-inline--fa{-webkit-transform-origin:center center;transform-origin:center center}.fa-layers-counter,.fa-layers-text{display:inline-block;position:absolute;text-align:center}.fa-layers-text{left:50%;top:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);-webkit-transform-origin:center center;transform-origin:center center}.fa-layers-counter{background-color:#ff253a;border-radius:1em;color:#fff;height:1.5em;line-height:1;max-width:5em;min-width:1.5em;overflow:hidden;padding:.25em;right:0;text-overflow:ellipsis;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top right;transform-origin:top right}.fa-layers-bottom-right{bottom:0;right:0;top:auto;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:bottom right;transform-origin:bottom right}.fa-layers-bottom-left{bottom:0;left:0;right:auto;top:auto;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:bottom left;transform-origin:bottom left}.fa-layers-top-right{right:0;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top right;transform-origin:top right}.fa-layers-top-left{left:0;right:auto;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top left;transform-origin:top left}.fa-lg{font-size:1.33333em;line-height:.75em;vertical-align:-.0667em}.fa-xs{font-size:.75em}.fa-sm{font-size:.875em}.fa-1x{font-size:1em}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-6x{font-size:6em}.fa-7x{font-size:7em}.fa-8x{font-size:8em}.fa-9x{font-size:9em}.fa-10x{font-size:10em}.fa-fw{text-align:center;width:1.25em}.fa-ul{list-style-type:none;margin-left:2.5em;padding-left:0}.fa-ul>li{position:relative}.fa-li{left:-2em;position:absolute;text-align:center;width:2em;line-height:inherit}.fa-border{border:solid .08em #eee;border-radius:.1em;padding:.2em .25em .15em}.fa-pull-left{float:left}.fa-pull-right{float:right}.fa.fa-pull-left,.fab.fa-pull-left,.fal.fa-pull-left,.far.fa-pull-left,.fas.fa-pull-left{margin-right:.3em}.fa.fa-pull-right,.fab.fa-pull-right,.fal.fa-pull-right,.far.fa-pull-right,.fas.fa-pull-right{margin-left:.3em}.fa-spin{-webkit-animation:fa-spin 2s infinite linear;animation:fa-spin 2s infinite linear}.fa-pulse{-webkit-animation:fa-spin 1s infinite steps(8);animation:fa-spin 1s infinite steps(8)}@-webkit-keyframes fa-spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes fa-spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.fa-rotate-90{-webkit-transform:rotate(90deg);transform:rotate(90deg)}.fa-rotate-180{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.fa-rotate-270{-webkit-transform:rotate(270deg);transform:rotate(270deg)}.fa-flip-horizontal{-webkit-transform:scale(-1,1);transform:scale(-1,1)}.fa-flip-vertical{-webkit-transform:scale(1,-1);transform:scale(1,-1)}.fa-flip-horizontal.fa-flip-vertical{-webkit-transform:scale(-1,-1);transform:scale(-1,-1)}:root .fa-flip-horizontal,:root .fa-flip-vertical,:root .fa-rotate-180,:root .fa-rotate-270,:root .fa-rotate-90{-webkit-filter:none;filter:none}.fa-stack{display:inline-block;height:2em;position:relative;width:2em}.fa-stack-1x,.fa-stack-2x{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}.svg-inline--fa.fa-stack-1x{height:1em;width:1em}.svg-inline--fa.fa-stack-2x{height:2em;width:2em}.fa-inverse{color:#fff}.sr-only{border:0;clip:rect(0,0,0,0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.sr-only-focusable:active,.sr-only-focusable:focus{clip:auto;height:auto;margin:0;overflow:visible;position:static;width:auto}</style><link rel="shortcut icon" href="http://127.0.0.1:5000/static/favicon.png" type="image/x-icon">
    <link rel="icon" href="http://127.0.0.1:5000/static/favicon.png" type="image/x-icon">
    <link type="text/css" rel="stylesheet" href="./App Store Admin_files/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="./App Store Admin_files/custom.css">

    <link type="text/css" rel="stylesheet" href="./App Store Admin_files/ui.fancytree.min.css">
    <link type="text/css" rel="stylesheet" href="./App Store Admin_files/dataTables.bootstrap4.min.css">

    <style type="text/css">
        div#tree {
            min-height: 300px;
            overflow-y: scroll;
            border: 1px solid #ced4da;
        }

        ul.fancytree-container {
            border: 0;
            outline: 0;
            /* No focus frame */
        }

        .card {
            border: 0;
        }
    </style>

<style id="style-1-cropbar-clipper">/* Copyright 2014 Evernote Corporation. All rights reserved. */
.en-markup-crop-options {
    top: 18px !important;
    left: 50% !important;
    margin-left: -100px !important;
    width: 200px !important;
    border: 2px rgba(255,255,255,.38) solid !important;
    border-radius: 4px !important;
}

.en-markup-crop-options div div:first-of-type {
    margin-left: 0px !important;
}
</style></head>

<body>
    <div class="admin container-fluid mt-3">
        <div class="card text-center">
            <div class="card-header">
                <ul class="nav nav-tabs card-header-tabs float-left">
                    <li class="nav-item ">
                        <a class="nav-link active" href="http://127.0.0.1:5000/#">Execution History</a>
                    </li>

                    <li class="nav-item ">
                        <a class="nav-link disabled" href="http://127.0.0.1:5000/#">Test</a>
                    </li>
                </ul>
                <button id="selectCases" class="btn btn-primary float-right ml-1" data-toggle="modal" data-target="#selectCaseModal">
                        <svg class="svg-inline--fa fa-plus-square fa-w-14 fa-lg" aria-hidden="true" data-fa-processed="" data-prefix="far" data-icon="plus-square" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M352 240v32c0 6.6-5.4 12-12 12h-88v88c0 6.6-5.4 12-12 12h-32c-6.6 0-12-5.4-12-12v-88h-88c-6.6 0-12-5.4-12-12v-32c0-6.6 5.4-12 12-12h88v-88c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v88h88c6.6 0 12 5.4 12 12zm96-160v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V80c0-26.5 21.5-48 48-48h352c26.5 0 48 21.5 48 48zm-48 346V86c0-3.3-2.7-6-6-6H54c-3.3 0-6 2.7-6 6v340c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z"></path></svg><!-- <i class="far fa-plus-square fa-lg"></i> -->
                </button>
                <div class="searchwrapper"></div>
                <input type="text" class="form-control w-25 float-right" id="recordSearch" placeholder="search">
            </div>
        </div>
        <div class="card table-responsive">
            


            <div id="recordsTable_wrapper" class="dataTables_wrapper container-fluid dt-bootstrap4 no-footer"><table id="recordsTable" class="table table-bordered dataTable no-footer" cellspacing="0" width="100%" role="grid" aria-describedby="recordsTable_info" style="width: 100%;">
                <thead class="thead-light">
                    <tr role="row"><th class="sorting_asc" tabindex="0" aria-controls="recordsTable" rowspan="1" colspan="1" aria-label="id: activate to sort column descending" style="width: 53px;" aria-sort="ascending">id</th><th class="sorting" tabindex="0" aria-controls="recordsTable" rowspan="1" colspan="1" aria-label="name: activate to sort column ascending" style="width: 215px;">name</th><th class="sorting" tabindex="0" aria-controls="recordsTable" rowspan="1" colspan="1" aria-label="owner: activate to sort column ascending" style="width: 111px;">owner</th><th class="sorting" tabindex="0" aria-controls="recordsTable" rowspan="1" colspan="1" aria-label="start time: activate to sort column ascending" style="width: 268px;">start time</th><th class="sorting" tabindex="0" aria-controls="recordsTable" rowspan="1" colspan="1" aria-label="end time: activate to sort column ascending" style="width: 143px;">end time</th><th class="sorting" tabindex="0" aria-controls="recordsTable" rowspan="1" colspan="1" aria-label="status: activate to sort column ascending" style="width: 121px;">status</th><th class="sorting" tabindex="0" aria-controls="recordsTable" rowspan="1" colspan="1" aria-label="log: activate to sort column ascending" style="width: 69px;">log</th></tr>
                </thead>
            <tbody><tr role="row" class="odd"><td class="sorting_1">1</td><td>test1.js</td><td></td><td>2018-02-01 08:04:47</td><td></td><td></td><td></td></tr><tr role="row" class="even"><td class="sorting_1">2</td><td>test1.js</td><td></td><td>2018-02-01 08:12:37</td><td></td><td></td><td></td></tr><tr role="row" class="odd"><td class="sorting_1">3</td><td>1233/333/test1.js</td><td></td><td>2018-02-01 08:13:56</td><td></td><td></td><td></td></tr><tr role="row" class="even"><td class="sorting_1">4</td><td>1233/333/test1.js</td><td></td><td>2018-02-01 08:14:07</td><td></td><td>SUCCESS</td><td></td></tr><tr role="row" class="odd"><td class="sorting_1">5</td><td>test1.js</td><td></td><td>2018-02-02 07:46:03</td><td></td><td>SUCCESS</td><td></td></tr></tbody></table><div class="bottom"><div class="dataTables_info" id="recordsTable_info" role="status" aria-live="polite">Showing 1 to 5 of 5 entries</div><div class="dataTables_length" id="recordsTable_length"><label>Show <select name="recordsTable_length" aria-controls="recordsTable" class="form-control form-control-sm"><option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select> entries</label></div><div class="dataTables_paginate paging_simple_numbers" id="recordsTable_paginate"><ul class="pagination"><li class="paginate_button page-item previous disabled" id="recordsTable_previous"><a href="http://127.0.0.1:5000/#" aria-controls="recordsTable" data-dt-idx="0" tabindex="0" class="page-link">Previous</a></li><li class="paginate_button page-item active"><a href="http://127.0.0.1:5000/#" aria-controls="recordsTable" data-dt-idx="1" tabindex="0" class="page-link">1</a></li><li class="paginate_button page-item next disabled" id="recordsTable_next"><a href="http://127.0.0.1:5000/#" aria-controls="recordsTable" data-dt-idx="2" tabindex="0" class="page-link">Next</a></li></ul></div></div><div class="clear"></div></div>

        </div>

    </div>


    <!-- Modal-Select-Case -->
    <div class="selectCase modal fade" id="selectCaseModal" tabindex="-1" role="dialog" aria-labelledby="selectCaseModal" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="selectCase container">
                    <input type="text" class="form-control my-3 " name="search" placeholder="search">

                    <div id="tree"></div>

                    <div class="clearfix">
                        <button id="execute" type="button" class="btn btn-primary my-3 float-right">Submit</button>
                    </div>
                </div>

            </div>
        </div>
    </div>


    <script src="./App Store Admin_files/jquery-3.2.1.min.js"></script>
    <script src="./App Store Admin_files/popper.min.js"></script>
    <script src="./App Store Admin_files/bootstrap.min.js"></script>
    <script src="./App Store Admin_files/jquery.fancytree-all-deps.min.js"></script>
    <script defer="" src="./App Store Admin_files/fontawesome-all.min.js"></script>
    <script src="./App Store Admin_files/jquery.dataTables.js"></script>
    <script src="./App Store Admin_files/dataTables.bootstrap4.min.js"></script>

    <script>
        $(function () {


            var table = $('#recordsTable').DataTable({
                "dom": 'rt<"bottom"ilp><"clear">',
                "ajax": {
                    "url": "/records",
                    "type": "GET"
                },
                "columns": [{
                        "data": "id"
                    },
                    {
                        "data": "name"
                    },
                    {
                        "data": "owner"
                    },
                    {
                        "data": "start_time"
                    },
                    {
                        "data": "end_time"
                    },
                    {
                        "data": "status"
                    },
                    {
                        "data": "log_path"
                    }
                ],
                "columnDefs": [{
                    "targets": 3,
                    "createdCell": function (td, cellData, rowData, row, col) {
                        if (cellData < 1) {
                            $(td).css('color', 'red')
                        }
                    }
                }],
                
            })
            $('#recordSearch').keyup(function () {
                table.search($(this).val()).draw();
            })

            $.get("/runnigRecords", function (data) {
                for (var i = 0; i < data["runningRecords"].length; i++) {
                    var record = data["runningRecords"][i];
                    $.each(record, function () {
                        var key = Object.keys(this)[0];
                        var value = this[key];
                    });
                    update_progress("/task_status", record["task_id"]);
                }


            });

            /*

            $.get("/runnigRecords", function (data) {
                for (record in data["runningRecords"]) {
                    status_url = '/task_status?task_id=%23'.replace("#", record["task_id"])
                    update_progress(status_url, record["id"]);

                }
                if (data['state'] == 'SUCCESS') {
                    var progressEelem = syncElem.parent().next(".executionSection").find(".progress");
                    progressEelem.remove();
                    var res =
                        '<span class="executionStatus"><a href="#" ><i class="far fa-file-alt"></i></a></span>'
                        .replace("#", "http://127.0.0.1:9900/browse/1233")
                    syncElem.parent().next(".executionSection").append(res)
                } else {
                    setTimeout(function () {
                        update_progress(status_url, syncElem);
                    }, 2000);
                }
            });
                */

            $('#selectCaseModal').on('show.bs.modal', function (e) {
                $("#tree").fancytree({
                    extensions: ["filter"],
                    quicksearch: true,
                    focusOnSelect: false,
                    filter: {
                        autoApply: true, // Re-apply last filter if lazy data is loaded
                        autoExpand: false, // Expand all branches that contain matches while filtered
                        counter: true, // Show a badge with number of matching child nodes near parent icons
                        fuzzy: false, // Match single characters in order, e.g. 'fb' will match 'FooBar'
                        hideExpandedCounter: true, // Hide counter badge if parent is expanded
                        hideExpanders: false, // Hide expanders if all child nodes are hidden by filter
                        highlight: true, // Highlight matches by wrapping inside <mark> tags
                        leavesOnly: false, // Match end nodes only
                        nodata: true, // Display a 'no data' status node if result is empty
                        mode: "hide" // Grayout unmatched nodes (pass "hide" to remove unmatched node instead)

                    },
                    checkbox: true,
                    selectMode: 3,
                    source: {
                        url: "/cases"
                    },
                    activate: function (event, data) {
                        $("#statusLine").text(event.type + ": " + data.node);
                    },
                    select: function (event, data) {
                        $("#statusLine").text(event.type + ": " + data.node.isSelected() +
                            " " + data.node);
                    }
                });
            })



            $("input[name=search]").keyup(function (e) {
                var n,
                    tree = $.ui.fancytree.getTree(),
                    args = "autoApply autoExpand fuzzy hideExpanders highlight leavesOnly nodata".split(
                        " "),
                    opts = {},
                    filterFunc = tree.filterNodes,
                    match = $(this).val();

                $.each(args, function (i, o) {
                    opts[o] = $("#" + o).is(":checked");
                });
                opts.mode = "hide";
                filterFunc.call(tree, match, opts);
            }).focus();


            $("input[name=record-search]").keyup(function (e) {
                var n,
                    tree = $.ui.fancytree.getTree(),
                    args = "autoApply autoExpand fuzzy hideExpanders highlight leavesOnly nodata".split(
                        " "),
                    opts = {},
                    filterFunc = tree.filterNodes,
                    match = $(this).val();

                $.each(args, function (i, o) {
                    opts[o] = $("#" + o).is(":checked");
                });
                opts.mode = "hide";
                filterFunc.call(tree, match, opts);
            }).focus();

            // Select a node on click
            $("#execute").click(function () {
                var tree = $("#tree").fancytree("getTree");
                var nodes = tree.getSelectedNodes();
                var url = "/async_execute";
                for (var i = 0; i < nodes.length; i++) {
                    if (!nodes[i].folder) {
                        $.post(url, {
                            "caseName": nodes[i].key
                        }, function (data, status, request) {
                            status_url = request.getResponseHeader('Location');
                            update_progress(status_url, syncElem, caseName);
                        });
                    }
                }
                $('#selectCaseModal').modal('hide');
                window.location.reload();
            });

            function update_progress(status_url, task_id) {
                $.ajax({
                    url: status_url,
                    type: "GET",
                    data: {
                        "task_id": task_id
                    },
                    success: function (data) {
                        if (data['state'] == 'SUCCESS') {
                            $.post("/update_task", data = {
                                "status": data['state'],
                                "task_id": task_id
                            });


                        } else {
                            setTimeout(function () {
                                update_progress(status_url, task_id);
                            }, 2000);
                        }
                    }


                })
                /*
                $.get(status_url, function(data){
                    if (data['state'] == 'SUCCESS'){
                        var progressEelem = syncElem.parent().next(".executionSection").find(".progress");
                        progressEelem.remove();
                        var res = '<span class="executionStatus"><a href="#" ><i class="far fa-file-alt"></i></a></span>'.replace("#","http://127.0.0.1:9900/browse/1233")
                        syncElem.parent().next(".executionSection").append(res)
                        }
                    else {
                        setTimeout(function(){
                            update_progress(status_url, syncElem);
                        },2000);
                    }
                });
                */
            }

        });
    </script>



</body></html>